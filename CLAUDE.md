# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Commands

### Build and Development
- `npm run generate` - Compile TypeScript to lib/ directory and run Prisma generate
- `npm run package:publish` - Run package.sh script and publish to npm from package/ directory

### Testing
This project does not include test scripts. Testing should be done through integration with actual Prisma schemas.

## Architecture Overview

This is a Prisma generator that creates tRPC Shield configurations from Prisma schemas. The generator follows Prisma's generator pattern and integrates with the Prisma CLI.

### Core Components

**Generator Entry Point** (`src/index.ts`):
- Uses `@prisma/generator-helper` to register the generator
- Defines manifest with default output directory `./generated`
- Requires `prisma-client-js` generator to be present

**Main Generator Logic** (`src/prisma-generator.ts`):
- Parses Prisma DMMF (Data Model Meta Format) to extract model operations
- Categorizes operations into queries (findUnique, findFirst, findMany, aggregate, groupBy) and mutations (createOne, deleteOne, updateOne, deleteMany, updateMany, upsertOne)
- Generates shield configuration file with all operations set to `allow` by default

**Shield Construction** (`src/helpers.ts`):
- Creates the actual tRPC Shield syntax
- Imports context from configurable path
- Generates TypeScript file with shield object containing query and mutation permissions

### Configuration

The generator accepts two main configuration options:
- `output`: Directory for generated shield file (default: `./generated`)
- `contextPath`: Path to tRPC context file (default: `../../../../src/context`)

### File Structure

- `src/` - TypeScript source code
- `lib/` - Compiled JavaScript output (generated by TypeScript)
- `package/` - Packaged version for npm publishing
- `prisma/` - Example Prisma schema and generated shield

### Build Process

The project compiles TypeScript from `src/` to `lib/` directory. The binary entry point is `lib/generator.js` which simply imports the main index file. The package.sh script handles packaging for npm distribution.